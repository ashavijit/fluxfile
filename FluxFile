var PROJECT = fluxfile

task fmt:
    desc: Format code
    run:
        go fmt ./...

task lint:
    desc: Run linter
    deps: fmt
    run:
        golangci-lint run

task build:
    desc: Build the Go binary
    deps: lint
    cache: true
    inputs:
        **/*.go
        go.mod
        go.sum
    outputs:
        bin/${PROJECT}
    run:
        go build -o bin/${PROJECT} ./cmd/${PROJECT}

task test:
    desc: Run all tests
    deps: build
    run:
        go test ./... -v

task dev:
    desc: Watch and rebuild
    watch: **/*.go
    ignore:
        vendor/**
        **/*_test.go
    run:
        go run ./cmd/${PROJECT}

task clean:
    desc: Remove build artifacts
    run:
        Remove-Item -Recurse -Force bin/ -ErrorAction SilentlyContinue

task task1:
    desc: Parallel task 1
    run:
        echo "Task 1 starting..."
        Start-Sleep -Seconds 1
        echo "Task 1 done"

task task2:
    desc: Parallel task 2
    run:
        echo "Task 2 starting..."
        Start-Sleep -Seconds 1
        echo "Task 2 done"

task task3:
    desc: Parallel task 3
    run:
        echo "Task 3 starting..."
        Start-Sleep -Seconds 1
        echo "Task 3 done"

task parallel-all:
    desc: Run tasks in parallel
    deps: task1, task2, task3
    parallel: true
    run:
        echo "All parallel tasks complete!"


profile dev:
    env:
        GO_ENV = development

profile prod:
    env:
        GO_ENV = production
