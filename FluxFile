var PROJECT = fluxfile

task fmt:
    desc: Format code
    run:
        go fmt ./...

task lint:
    desc: Run linter
    deps: fmt
    run:
        golangci-lint run

task build:
    desc: Build the Go binary
    deps: lint
    cache: true
    inputs:
        **/*.go
        go.mod
        go.sum
    outputs:
        bin/${PROJECT}
    run:
        go build -o bin/${PROJECT} ./cmd/${PROJECT}

task test:
    desc: Run all tests
    deps: build
    run:
        go test ./... -v

task dev:
    desc: Watch and rebuild
    watch: **/*.go
    ignore:
        vendor/**
        **/*_test.go
    run:
        go run ./cmd/${PROJECT}

task clean:
    desc: Remove build artifacts
    run:
        rm -rf bin/

profile dev:
    env:
        GO_ENV = development

profile prod:
    env:
        GO_ENV = production
